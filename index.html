<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>HSBJK | Ultimate Handâ€‘Controlled 3D Particle Universe</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- THREE.JS -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<!-- MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<!-- AUDIO -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/libs/stats.module.js"></script>

<style>
html,body{margin:0;overflow:hidden;background:#02030a;font-family:system-ui}
#video{position:fixed;right:12px;bottom:12px;width:150px;opacity:.1;border-radius:12px;z-index:10}
.brand{position:fixed;left:18px;bottom:18px;font-weight:900;letter-spacing:3px;font-size:14px;background:linear-gradient(90deg,#ff2fdc,#00f7ff,#9d7bff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
</style>
</head>
<body>

<video id="video" autoplay muted playsinline></video>
<div class="brand">Powered by HSBJK</div>

<script>
/* ================= CORE ================= */
const scene=new THREE.Scene();
scene.fog=new THREE.Fog(0x000000,40,160);

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,1000);
camera.position.z=55;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

window.onresize=()=>{
camera.aspect=innerWidth/innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(innerWidth,innerHeight);
};

/* ================= PARTICLES ================= */
const COUNT=22000;
const geo=new THREE.BufferGeometry();
const pos=new Float32Array(COUNT*3);
const col=new Float32Array(COUNT*3);

for(let i=0;i<COUNT;i++){
 pos[i*3]=(Math.random()-.5)*60;
 pos[i*3+1]=(Math.random()-.5)*60;
 pos[i*3+2]=(Math.random()-.5)*60;
 col[i*3]=Math.random();
 col[i*3+1]=Math.random();
 col[i*3+2]=1;
}
geo.setAttribute('position',new THREE.BufferAttribute(pos,3));
geo.setAttribute('color',new THREE.BufferAttribute(col,3));

const mat=new THREE.PointsMaterial({size:.18,vertexColors:true,transparent:true,blending:THREE.AdditiveBlending,depthWrite:false});
const points=new THREE.Points(geo,mat);
scene.add(points);

/* ================= SHAPES ================= */
const shapes={
heart:t=>new THREE.Vector3(16*Math.pow(Math.sin(t),3)/6,(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))/6,Math.sin(t*4)),
flower:t=>{const r=Math.sin(7*t)*6+10;return new THREE.Vector3(Math.cos(t)*r,Math.sin(t)*r,Math.sin(t*5))},
saturn:t=>new THREE.Vector3(Math.cos(t)*14,Math.sin(t*.5)*4,Math.sin(t)*14),
spiral:t=>new THREE.Vector3(Math.cos(t)*t*.8,Math.sin(t)*t*.8,Math.sin(t*2)*5),
fireworks:()=>new THREE.Vector3((Math.random()-.5)*80,(Math.random()-.5)*80,(Math.random()-.5)*80)
};

const shapeKeys=Object.keys(shapes);let shapeIndex=0;
function morph(){
 for(let i=0;i<COUNT;i++){
  const t=i/COUNT*Math.PI*2*14;
  const v=shapeKeys[shapeIndex]==='fireworks'?shapes.fireworks():shapes[shapeKeys[shapeIndex]](t);
  pos[i*3]=v.x;pos[i*3+1]=v.y;pos[i*3+2]=v.z;
 }
 geo.attributes.position.needsUpdate=true;
}
morph();

/* ================= HAND + FACE ================= */
const video=document.getElementById('video');
let pinch=.12,last=0;

const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.65,minTrackingConfidence:.65});

hands.onResults(r=>{
 if(r.multiHandLandmarks?.length){
  const lm=r.multiHandLandmarks[0];
  const dx=lm[4].x-lm[8].x,dy=lm[4].y-lm[8].y;
  pinch=Math.sqrt(dx*dx+dy*dy);
  if(pinch<.035 && performance.now()-last>600){
    shapeIndex=(shapeIndex+1)%shapeKeys.length;
    morph();last=performance.now();
  }
 }
});

const face=new FaceMesh({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`});
face.setOptions({maxNumFaces:1,refineLandmarks:true,minDetectionConfidence:.6,minTrackingConfidence:.6});
face.onResults(r=>{ if(r.multiFaceLandmarks?.length){ points.rotation.y=(r.multiFaceLandmarks[0][1].x-.5)*2; }});

const cam=new Camera(video,{onFrame:async()=>{await hands.send({image:video});await face.send({image:video});},width:640,height:480});
cam.start();

/* ================= AUDIO REACTIVE ================= */
let analyser,data;
navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
 const ctx=new AudioContext();
 const src=ctx.createMediaStreamSource(stream);
 analyser=ctx.createAnalyser();
 analyser.fftSize=256;
 src.connect(analyser);
 data=new Uint8Array(analyser.frequencyBinCount);
});

/* ================= ANIMATE ================= */
function animate(){
 requestAnimationFrame(animate);

 let audioBoost=1;
 if(analyser){ analyser.getByteFrequencyData(data); audioBoost=data[5]/80; }

 const scale=THREE.MathUtils.clamp(1/pinch,0.6,3.2)*audioBoost;
 points.scale.set(scale,scale,scale);
 points.rotation.y+=.002;
 points.rotation.x+=.0015;

 renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
